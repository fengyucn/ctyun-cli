# 版本号刷新规则

本文档定义了天翼云CLI工具的版本号刷新规则，基于语义化版本控制（Semantic Versioning）实践。

## 版本号格式

**格式**：`主版本号.次版本号.修订版本号`
**示例**：`1.6.0`、`2.0.1`、`1.4.12`

---

## 🔢 第一位：主版本号 (MAJOR)

**触发条件：不兼容的API变更**

### 🚨 必须刷新的情况：

#### API接口变更
- 删除了现有的CLI命令
- 修改了现有命令的必填参数
- 更改了命令名称或结构
- 改变了输出格式的JSON结构

#### 配置文件格式变更
- `~/.ctyun/config` 格式不兼容
- 环境变量名称变更

#### Python版本兼容性
- 提升最低Python版本要求
- 移除对某个Python版本的支持

#### 重大架构重构
- 核心认证机制变更
- 模块导入路径变更

### 📋 示例：
```
1.5.0 → 2.0.0  (删除了ctyun-cli vpc list命令)
1.4.0 → 2.0.0  (Python最低版本从3.8提升到3.9)
```

### ⚠️ 注意事项：
- 需要提供详细的迁移指南
- 考虑向后兼容性过渡期
- 更新所有相关文档

---

## 🔧 第二位：次版本号 (MINOR)

**触发条件：向后兼容的功能新增**

### ✅ 应该刷新的情况：

#### 新增CLI命令
- 添加新的服务模块
- 新增子命令或功能选项

#### 新增API支持
- 实现新的云服务API接口
- 扩展现有命令的功能

#### 增强功能
- 新增输出格式支持
- 添加新的配置选项
- 性能优化和改进

#### 新增云服务
- 支持新的天翼云产品
- 扩展地域支持

### 📋 示例：
```
1.5.0 → 1.6.0  (添加VPC new系列API支持)
1.4.0 → 1.5.0  (新增Redis服务支持)
1.3.0 → 1.4.0  (添加YAML输出格式)
```

### ✨ 开发原则：
- 确保向后兼容性
- 完整的功能测试
- 更新相关文档

---

## 🐛 第三位：修订版本号 (PATCH)

**触发条件：向后兼容的问题修复**

### 🔧 应该刷新的情况：

#### Bug修复
- 修复API调用错误
- 修复CLI参数解析问题
- 修复输出格式问题

#### 错误处理改进
- 改善异常处理逻辑
- 优化错误信息显示

#### 文档更新
- 修正帮助文档
- 更新命令说明

#### 小的改进
- 日志输出优化
- 代码重构但不影响功能
- 性能微调

### 📋 示例：
```
1.5.0 → 1.5.1  (修复VPC查询的认证问题)
1.5.1 → 1.5.2  (修正帮助文档错误)
1.4.3 → 1.4.4  (优化JSON输出格式)
```

### 🔍 修复原则：
- 最小化变更范围
- 保持API兼容性
- 充分的回归测试

---

## 📅 发布频率建议

### 主版本 (MAJOR)
- **频率**：每年1-2次
- **时机**：重大功能重构或架构变更
- **注意**：需要详细的迁移指南

### 次版本 (MINOR)
- **频率**：每2-4周一次
- **时机**：新功能开发完成并测试通过
- **节奏**：与项目开发里程碑同步

### 修订版本 (PATCH)
- **频率**：根据需要，可能每周多次
- **时机**：bug修复完成后立即发布
- **原则**：修复越早发布越好

---

## 🔄 版本发布工作流

### 发布前检查清单
1. ✅ 功能完整性测试
2. ✅ 向后兼容性验证
3. ✅ 文档更新完成
4. ✅ 版本号同步更新
5. ✅ CHANGELOG更新

### 发布步骤
```bash
# 1. 更新版本号文件
vim pyproject.toml     # 更新version字段
vim setup.py          # 更新version字段
vim README.md         # 更新版本说明

# 2. 更新CHANGELOG
vim CHANGELOG.md      # 添加版本变更记录

# 3. 构建包
python -m build --wheel --no-isolation

# 4. 测试安装
pip install dist/ctyun_cli-*.whl

# 5. 发布到PyPI
python -m twine upload dist/*

# 6. Git标签
git tag v1.6.0
git push origin v1.6.0
```

### 需要同步更新的文件
- `pyproject.toml` - 主要版本配置
- `setup.py` - 向后兼容的setup脚本
- `README.md` - 项目说明文档
- `CHANGELOG.md` - 版本变更记录
- `VERSION_FILES.md` - 版本文件索引

---

## 🎯 项目版本历史

### 当前版本建议
基于当前项目状态和已完成的功能，推荐版本更新：

- **当前版本**：1.5.0
- **建议版本**：1.6.0
- **更新原因**：新增VPC new系列API和showVpc功能

### 版本发布记录模板
```markdown
## v1.6.0 (2025-12-03)

### 新增功能 (Added)
- 新增VPC new-list命令，支持游标分页的高性能VPC查询
- 新增VPC subnet new-list命令，支持游标分页的子网查询
- 新增VPC security new-query命令，支持模糊查询的安全组查询
- 新增VPC show命令，用于查询单个VPC的详细信息

### 改进 (Improved)
- 优化VPC模块的API性能，支持游标分页机制
- 增强安全组查询功能，支持按VPC ID和实例ID筛选
- 完善错误处理机制，提供更友好的错误信息

### 技术细节 (Technical)
- 实现基于nextToken的游标分页，提升大数据量查询性能
- 添加clientToken支持，确保子网查询的幂等性
- 优化输出格式，支持table、json、yaml三种格式
```

---

## 📚 参考资源

- [Semantic Versioning 2.0.0](https://semver.org/)
- [Python Packaging User Guide](https://packaging.python.org/)
- [PEP 440 - Version Identification](https://peps.python.org/pep-0440/)

---

*文档创建时间：2025-12-03*
*最后更新：2025-12-03*
*维护者：CTyun CLI开发团队*